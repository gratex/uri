<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>builder.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-builder.html">builder</a><ul class='methods'><li data-type='method'><a href="module-builder.html#.raw">raw</a></li><li data-type='method'><a href="module-builder.html#.uriBuilder">uriBuilder</a></li></ul></li><li><a href="module-uri.html">uri</a><ul class='methods'><li data-type='method'><a href="module-uri.html#.checkEncoding">checkEncoding</a></li><li data-type='method'><a href="module-uri.html#.decodeSegments">decodeSegments</a></li><li data-type='method'><a href="module-uri.html#.decomposeComponents">decomposeComponents</a></li><li data-type='method'><a href="module-uri.html#.encodeSegments">encodeSegments</a></li><li data-type='method'><a href="module-uri.html#.isSubordinate">isSubordinate</a></li><li data-type='method'><a href="module-uri.html#.parseQuery">parseQuery</a></li><li data-type='method'><a href="module-uri.html#.percentEncode">percentEncode</a></li><li data-type='method'><a href="module-uri.html#.recomposeAuthorityComponents">recomposeAuthorityComponents</a></li><li data-type='method'><a href="module-uri.html#.recomposeComponents">recomposeComponents</a></li><li data-type='method'><a href="module-uri.html#.removeDotSegments">removeDotSegments</a></li><li data-type='method'><a href="module-uri.html#.resolve">resolve</a></li></ul></li><li><a href="module-Uri_.html">Uri</a><ul class='methods'><li data-type='method'><a href="module-Uri_.html#.appendFragment">appendFragment</a></li><li data-type='method'><a href="module-Uri_.html#.appendQuery">appendQuery</a></li><li data-type='method'><a href="module-Uri_.html#.appendSegments">appendSegments</a></li><li data-type='method'><a href="module-Uri_.html#.convertToFolder">convertToFolder</a></li><li data-type='method'><a href="module-Uri_.html#.denotesFolder">denotesFolder</a></li><li data-type='method'><a href="module-Uri_.html#.equals">equals</a></li><li data-type='method'><a href="module-Uri_.html#.getAuthority">getAuthority</a></li><li data-type='method'><a href="module-Uri_.html#.getFragment">getFragment</a></li><li data-type='method'><a href="module-Uri_.html#.getHost">getHost</a></li><li data-type='method'><a href="module-Uri_.html#.getLastSegment">getLastSegment</a></li><li data-type='method'><a href="module-Uri_.html#.getPath">getPath</a></li><li data-type='method'><a href="module-Uri_.html#.getPort">getPort</a></li><li data-type='method'><a href="module-Uri_.html#.getQuery">getQuery</a></li><li data-type='method'><a href="module-Uri_.html#.getScheme">getScheme</a></li><li data-type='method'><a href="module-Uri_.html#.getScreenPath">getScreenPath</a></li><li data-type='method'><a href="module-Uri_.html#.getSegments">getSegments</a></li><li data-type='method'><a href="module-Uri_.html#.getUserInfo">getUserInfo</a></li><li data-type='method'><a href="module-Uri_.html#.isSubordinate">isSubordinate</a></li><li data-type='method'><a href="module-Uri_.html#.mixin">mixin</a></li><li data-type='method'><a href="module-Uri_.html#.parseId">parseId</a></li><li data-type='method'><a href="module-Uri_.html#.resolve">resolve</a></li><li data-type='method'><a href="module-Uri_.html#.resolveAsSubordinate">resolveAsSubordinate</a></li><li data-type='method'><a href="module-Uri_.html#.setAuthority">setAuthority</a></li><li data-type='method'><a href="module-Uri_.html#.setFragment">setFragment</a></li><li data-type='method'><a href="module-Uri_.html#.setHost">setHost</a></li><li data-type='method'><a href="module-Uri_.html#.setPath">setPath</a></li><li data-type='method'><a href="module-Uri_.html#.setPort">setPort</a></li><li data-type='method'><a href="module-Uri_.html#.setQuery">setQuery</a></li><li data-type='method'><a href="module-Uri_.html#.setScheme">setScheme</a></li><li data-type='method'><a href="module-Uri_.html#.setSegments">setSegments</a></li><li data-type='method'><a href="module-Uri_.html#.setUserInfo">setUserInfo</a></li><li data-type='method'><a href="module-Uri_.html#.strip">strip</a></li><li data-type='method'><a href="module-Uri_.html#.stripCtxPath">stripCtxPath</a></li><li data-type='method'><a href="module-Uri_.html#.stripCtxPrefix">stripCtxPrefix</a></li><li data-type='method'><a href="module-Uri_.html#.stripExtension">stripExtension</a></li><li data-type='method'><a href="module-Uri_.html#.stripFragment">stripFragment</a></li><li data-type='method'><a href="module-Uri_.html#.stripOrigin">stripOrigin</a></li><li data-type='method'><a href="module-Uri_.html#.stripPath">stripPath</a></li><li data-type='method'><a href="module-Uri_.html#.stripQuery">stripQuery</a></li><li data-type='method'><a href="module-Uri_.html#.toString">toString</a></li><li data-type='method'><a href="module-Uri_.html#.toUri">toUri</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">builder.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module builder
*/

const uri = require('../src/_uri');

const PLACEHOLDER = '$$$'; // should be safe string, not occuring in url templates, and not breaking decomposition
const REPLACE = /\$\$\$/g;

class EncodedString {
    // represents encoded String
    // new Class to be able to make instanceOf
    // needed by encode function to know if encode or not

    constructor(value) {
        this.string = `${value}`; // template to get string from value
    }
}

function encode(value, encoder) {
    return value instanceof EncodedString ? value.string : encoder(`${value}`); // template to get string from value
}

/**
 * ES6 template literal tag, used to build URLs safely (correctly encoded path/query/segment)
 * @memberof module:builder
 * @example
 * import { uriBuilder } from '@gjax/uri'
 * const url = uriBuilder`/foo/${p1}/bar/?x=${p2}#/baz/${p3}`
 * @returns {string} builded URL
 *
 */
function uriBuilder(strings, ...values) {
    const uriTemplate = strings.reduce((last, actual) => `${last}${PLACEHOLDER}${actual}`);

    let { path, query, fragment, ...otherComponents } = uri.decomposeComponents(uriTemplate);

    path = path &amp;&amp; path.replace(REPLACE, () => encode(values.shift(), uri.encodeSegment));
    query = query &amp;&amp; query.replace(REPLACE, () => encode(values.shift(), uri.encodeQuery));
    fragment = fragment &amp;&amp; fragment.replace(REPLACE, () => encode(values.shift(), uri.encodeFragment));

    const recomposed = uri.recomposeComponents({ ...otherComponents, path, query, fragment });

    if (REPLACE.test(recomposed)) {
        throw new Error('Params outside path/query/fragment are unsupported');
    }
    return recomposed;
}

/**
 * Use to wrap value for uriBuilder to enforce no encoding for it
 * @param value
 * @memberof module:builder
 * @example
 * import { uriBuilder, raw } from '@gjax/uri'
 * const query = 'name=John%20Doe&amp;age=20';
 * const url = builder`/foo/${p1}/bar/?${raw(query)}`
 * @returns object representing wrapped value with encoded flag.
 */
function raw(string) {
    return new EncodedString(string);
}

module.exports = {
    uriBuilder,
    raw
};
</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Mon Aug 13 2018 09:57:28 GMT+0200 (CEST) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
